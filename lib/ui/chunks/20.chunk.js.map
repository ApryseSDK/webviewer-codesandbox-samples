{"version":3,"sources":["webpack:///./src/ui/src/helpers/getAnnotationStyles.js","webpack:///./src/ui/src/components/AnnotationStylePopup/AnnotationStylePopup.scss?3394","webpack:///./src/ui/src/components/AnnotationStylePopup/AnnotationStylePopup.scss","webpack:///./src/ui/src/components/AnnotationStylePopup/AnnotationStylePopup.js","webpack:///./src/ui/src/components/AnnotationStylePopup/index.js","webpack:///./src/ui/src/components/AnnotationPopup/AnnotationPopup.scss?819b","webpack:///./src/ui/src/components/CalibrationPopup/CalibrationPopup.scss?bc6f","webpack:///./src/ui/src/components/CalibrationPopup/CalibrationPopup.scss","webpack:///./src/ui/src/components/AnnotationPopup/AnnotationPopup.scss","webpack:///./src/ui/src/components/DatePicker/DatePicker.js","webpack:///./src/ui/src/components/DatePicker/index.js","webpack:///./src/ui/src/components/CalibrationPopup/CalibrationPopup.js","webpack:///./src/ui/src/components/CalibrationPopup/index.js","webpack:///./src/ui/src/components/AnnotationPopup/AnnotationPopup.js","webpack:///./src/ui/src/components/AnnotationPopup/AnnotationPopupContainer.js","webpack:///./src/ui/src/components/AnnotationPopup/index.js"],"names":["annotation","style","forEach","property","value","elementName","core","isBlendModeSupported","Opacity","isFormFieldPlaceholder","api","content","__esModule","default","module","i","options","styleTag","webComponents","document","getElementsByTagName","length","clonedStyleTags","webComponent","shadowRoot","appendChild","onload","styleNode","innerHTML","cloneNode","push","head","exports","locals","propTypes","annotations","PropTypes","array","isRequired","object","properties","isRedaction","bool","isFreeText","isEllipse","hasBackToMenu","onBackToMenu","func","AnnotationStylePopup","props","isMeasure","colorMapKey","showLineStyleOptions","hideSnapModeCheckbox","onResize","useSelector","state","selectors","isElementDisabled","DataElements","ANNOTATION_STYLE_POPUP","isToolDefaultStyleUpdateFromAnnotationPopupEnabled","isDisabled","dispatch","useDispatch","t","useTranslation","handleSliderChange","annotationManager","getAnnotationManager","redrawAnnotation","handlePropertyChange","setAnnotationStyles","setToolStyles","ToolName","FreeTextAnnotation","window","Core","Annotations","getAutoSizeType","AutoSizeTypes","NONE","doc","getDocument","pageNumber","pageInfo","getPageInfo","pageMatrix","getPageMatrix","pageRotation","getPageRotation","fitText","adjustFreeTextBoundingBox","handleStyleChange","handleRichTextStyleChange","updateAnnotationRichTextStyle","handleLineStyleChange","section","lineStyle","setStartStyle","setEndStyle","dashes","split","shift","trigger","handleClick","e","isMobile","target","currentTarget","actions","closeElement","ANNOTATION_POPUP","className","getClassName","measureRef","data-element","onClick","ref","ANNOTATION_STYLE_POPUP_BACK_BUTTON_CONTAINER","ActionButton","dataElement","ANNOTATION_STYLE_POPUP_BACK_BUTTON","label","img","StylePopup","onStyleChange","onSliderChange","onPropertyChange","disableSeparator","onRichTextStyleChange","onLineStyleChange","DatePicker","onDatePickerShow","dateRef","useRef","dateContainerRef","useEffect","datePicker","createDatePicker","field","current","container","format","getDateFormat","getDatePicker","destroy","Scale","parseMeasurementContentsByAnnotation","factor","Measure","axis","getLineLength","CalibrationPropType","shape","arrayOf","CalibrationPopup","getMeasurementUnits","getCalibrationInfo","shallowEqual","measurementUnits","tempScale","isFractionalUnit","defaultUnit","useState","valueDisplay","setValueDisplay","inputRef","unitTo","worldScale","unit","unitToOptions","to","filter","fractionalUnits","includes","isFractionalUnitsToggleDisabled","valueInputType","inputValueClass","classNames","updateTempScale","scaleValue","scaleUnit","pageUnit","currentDistance","currentScale","newRatio","pageScale","defaultPageUnit","metricUnits","defaultPageValue","convertUnit","updateCalibrationInfo","setValue","updateValueDisplay","newValueDisplay","getFormattedValue","tempScaleRef","onAnnotationChanged","action","currentUnit","addEventListener","removeEventListener","deleteAnnotations","activeElement","type","min","onChange","inputValue","trim","inFractionalRegex","test","result","parseInFractional","ftInFractionalRegex","parseFtInFractional","ftInDecimalRegex","parseFtInDecimal","floatRegex","parseFloat","onBlur","placeholder","hintValues","Tooltip","Dropdown","items","currentSelectionKey","onClickItem","Choice","isSwitch","leftLabel","disabled","checked","id","isIE","isOpen","isRightClickMenu","isNotesPanelOpenOrActive","isRichTextPopupOpen","isLinkModalOpen","isContextMenuPopupOpen","focusedAnnotation","popupRef","any","position","showViewFileButton","onViewFile","showCommentButton","onCommentAnnotation","isDateFreeTextCanEdit","isDatePickerOpen","handleDateChange","isCalibrationPopupOpen","showEditStyleButton","isStylePopupOpen","openEditStylePopup","closeEditStylePopup","annotationStyle","showContentEditButton","onEditContent","openContentEditDeleteWarningModal","isAppearanceSignature","onClearAppearanceSignature","showRedactionButton","onApplyRedaction","showGroupButton","onGroupAnnotations","showUngroupButton","onUngroupAnnotations","showFormFieldButton","onOpenFormField","showDeleteButton","onDeleteAnnotation","showLinkButton","hasAssociatedLink","linkAnnotationToURL","showFileDownloadButton","downloadFileAttachment","showAudioPlayButton","handlePlaySound","showCalibrateButton","onOpenCalibration","AnnotationPopup","shortCutKeysFor3DVisible","setShortCutKeysFor3DVisible","commentButtonLabel","commentButtonImg","show3DShortCutButton","Model3DAnnotation","isRectangle","RectangleAnnotation","EllipseAnnotation","isPolygon","PolygonAnnotation","getIntent","Intent","FreeText","FreeTextCallout","RedactionAnnotation","mapAnnotationToKey","getDataWithKey","mapToolNameToKey","hasLineEndings","isInstanceActive","isApryseWebViewerWebComponent","getRootNode","StrokeStyle","isContentEdit","isContentEditPlaceholder","err","console","error","StartLineStyle","getStartStyle","EndLineStyle","getEndStyle","richTextStyles","getRichTextStyle","Font","FontSize","TextAlign","TextVerticalAlign","bold","italic","underline","strikeout","OverlayText","annotationPopup","Popup","open","closed","stylePopupOpen","FocusTrap","locked","CustomizablePopup","childrenClassName","title","CALIBRATION_POPUP_BUTTON","renderPopup","cancel","ToolNames","Tools","selectedMultipleAnnotations","canModify","setIsStylePopupOpen","setDatePickerOpen","isDatePickerMount","setDatePickerMount","includesFormFieldAnnotation","stylePopupRepositionFlag","setStylePopupRepositionFlag","closePopup","AnnotationPopupContainer","isElementOpen","CONTEXT_MENU_POPUP","isRightClickAnnotationPopupEnabled","NOTES_PANEL","INLINE_COMMENT_POPUP","LINK_MODAL","getIsMultiTab","getTabManager","getTabs","getNotesInLeftPanel","LEFT_PANEL","getActiveLeftPanel","getActiveDocumentViewerKey","isNotesPanelDisabled","isAnnotationStylePopupDisabled","isInlineCommentingDisabled","isNotesPanelOpen","isMultiTab","tabManager","tabs","notesInLeftPanel","leftPanelOpen","activeLeftPanel","activeDocumentViewerKey","left","top","setPosition","setCalibrationPopupOpen","isFocusedAnnotationSelected","isAnnotationSelected","annotManager","useOnClickOutside","useCallback","notesPanel","querySelector","clickedInNotesPanel","contains","clickedInLinkModal","warningModal","getOpenedWarningModal","colorPicker","getOpenedColorPicker","useLayoutEffect","getAnnotationPopupPositionBasedOn","CALIBRATION_MEASUREMENT","acceptFormats","getHashParameters","SupportedFileFormats","SERVER","CLIENT","FileAttachmentAnnotation","mimeTypeToExtension","getFileMetadata","mimeType","warn","metaData","fileAttachmentTab","find","tab","filename","setActiveTab","getFileData","extension","saveCurrentActiveTabState","setActive","addTab","selectedAnnotations","getSelectedAnnotations","numberOfSelectedAnnotations","multipleAnnotationsSelected","canModifyContents","numberOfGroups","getNumberOfGroups","canGroup","canUngroup","SignatureWidgetAnnotation","isSignedByAppearance","CROP","isUncommittedContentEditPlaceholder","getAnnotationStyles","hasStyle","Object","keys","toolsWithNoStyling","RADIO_FORM_FIELD","CHECK_BOX_FIELD","VIDEO_REDACTION","VIDEO_AND_AUDIO_REDACTION","AUDIO_REDACTION","isFullPDFEnabled","getContentEditType","ContentEdit","Types","TEXT","isAnnotationRedactable","primaryAnnotation","selectedAnnotation","InReplyTo","isInFormFieldCreationMode","getFormFieldCreationManager","SIGNATURE","REDACTION","REDACTION2","REDACTION3","REDACTION4","STICKY","STICKY2","STICKY3","STICKY4","SoundAnnotation","LineAnnotation","hasAudioData","contentEditManager","getContentEditManager","isInContentEditMode","endContentEditMode","triggerNoteEditing","openElement","text","setNoteContents","updateAnnotation","isDatePickerShowed","warning","message","confirmBtnText","onConfirm","showWarningMessage","clearSignature","applyRedactions","groupAnnotations","ungroupAnnotations","disableElement","PRIORITY_THREE","FORM_FIELD_EDIT_POPUP","annot","getGroupedLinkAnnotations","linkAnnot","index","TextHighlightAnnotation","deleteAnnotation","setActiveSoundAnnotation","triggerResetAudioPlaybackPosition","CALIBRATION_MODAL"],"mappings":"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","file":"chunks/20.chunk.js","sourcesContent":["import core from 'core';\r\n\r\n/**\r\n * We can just pass object down as a prop, but many properties of that object won't be used by the child component,\r\n * so here we select properties that will be used.\r\n * @ignore\r\n * @param annotation is an annotation created by a tool\r\n * @return current style of that object.\r\n */\r\nexport default (annotation) => {\r\n  const styleProperty = [\r\n    'FillColor',\r\n    'StrokeColor',\r\n    'TextColor',\r\n    'Opacity',\r\n    'StrokeThickness',\r\n    'FontSize',\r\n    'Precision',\r\n    'Scale',\r\n    'Style',\r\n  ];\r\n  const style = {};\r\n\r\n  styleProperty.forEach((property) => {\r\n    const value = annotation[property];\r\n\r\n    if (value !== null && value !== undefined) {\r\n      style[property] = annotation[property];\r\n    }\r\n  });\r\n\r\n  // Special case for the highlight annotation. It only have opacity when blend mode is working\r\n  if (annotation.elementName === 'highlight' && !core.isBlendModeSupported(annotation['BlendMode'])) {\r\n    style.Opacity = null;\r\n  }\r\n\r\n  // widget don't support opacity\r\n  if (annotation.isFormFieldPlaceholder()) {\r\n    style.Opacity = null;\r\n  }\r\n\r\n  return style;\r\n};\r\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./AnnotationStylePopup.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function (styleTag) {\r\n                const webComponents = document.getElementsByTagName('apryse-webviewer');\r\n                if (webComponents.length > 0) {\r\n                  const clonedStyleTags = [];\r\n                  for (let i = 0; i < webComponents.length; i++) {\r\n                    const webComponent = webComponents[i];\r\n                    if (i === 0) {\r\n                      webComponent.shadowRoot.appendChild(styleTag);\r\n                      styleTag.onload = function () {\r\n                        if (clonedStyleTags.length > 0) {\r\n                          clonedStyleTags.forEach((styleNode) => {\r\n                            // eslint-disable-next-line no-unsanitized/property\r\n                            styleNode.innerHTML = styleTag.innerHTML;\r\n                          });\r\n                        }\r\n                      };\r\n                    } else {\r\n                      const styleNode = styleTag.cloneNode(true);\r\n                      webComponent.shadowRoot.appendChild(styleNode);\r\n                      clonedStyleTags.push(styleNode);\r\n                    }\r\n                  }\r\n                } else {\r\n                  document.head.appendChild(styleTag);\r\n                }\r\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}@-webkit-keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@-webkit-keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}@media(max-width:640px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .AnnotationStylePopup{width:100%;margin:0;position:relative;max-width:none;border-radius:4px 4px 0 0;border:0;padding-bottom:24px;box-shadow:none}}@container (max-width: 640px){.App.is-web-component:not(.is-in-desktop-only-mode) .AnnotationStylePopup{width:100%;margin:0;position:relative;max-width:none;border-radius:4px 4px 0 0;border:0;padding-bottom:24px;box-shadow:none}}.AnnotationStylePopup .back-to-menu-container{margin-top:var(--padding-medium);margin-right:var(--padding-medium);margin-left:var(--padding-medium);padding-bottom:var(--padding-small);border-bottom:1px solid var(--border)}.AnnotationStylePopup .Button.back-to-menu-button{margin:0;width:100%;height:32px;border-radius:0;justify-content:flex-start}@media(max-width:640px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .AnnotationStylePopup .Button.back-to-menu-button{width:100%;height:32px}}@container (max-width: 640px){.App.is-web-component:not(.is-in-desktop-only-mode) .AnnotationStylePopup .Button.back-to-menu-button{width:100%;height:32px}}\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"LEFT_HEADER_WIDTH\": \"41px\",\n\t\"RIGHT_HEADER_WIDTH\": \"41px\"\n};","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Measure from 'react-measure';\r\nimport { useTranslation } from 'react-i18next';\r\nimport StylePopup from 'components/StylePopup';\r\nimport ActionButton from 'components/ActionButton';\r\nimport core from 'core';\r\nimport getClassName from 'helpers/getClassName';\r\nimport setToolStyles from 'helpers/setToolStyles';\r\nimport { isMobile } from 'helpers/device';\r\nimport actions from 'actions';\r\nimport selectors from 'selectors';\r\nimport DataElements from 'constants/dataElement';\r\n\r\nimport './AnnotationStylePopup.scss';\r\n\r\nconst propTypes = {\r\n  annotations: PropTypes.array.isRequired,\r\n  style: PropTypes.object.isRequired,\r\n  properties: PropTypes.object.isRequired,\r\n  isRedaction: PropTypes.bool,\r\n  isFreeText: PropTypes.bool,\r\n  isEllipse: PropTypes.bool,\r\n  hasBackToMenu: PropTypes.bool,\r\n  onBackToMenu: PropTypes.func,\r\n};\r\n\r\nconst AnnotationStylePopup = (props) => {\r\n  const {\r\n    annotations,\r\n    style,\r\n    isRedaction,\r\n    isFreeText,\r\n    isEllipse,\r\n    isMeasure,\r\n    colorMapKey,\r\n    showLineStyleOptions,\r\n    properties,\r\n    hideSnapModeCheckbox,\r\n    onResize,\r\n    hasBackToMenu,\r\n    onBackToMenu\r\n  } = props;\r\n\r\n  const [\r\n    isDisabled,\r\n    isToolDefaultStyleUpdateFromAnnotationPopupEnabled\r\n  ] = useSelector((state) => [\r\n    selectors.isElementDisabled(state, DataElements.ANNOTATION_STYLE_POPUP),\r\n    selectors.isToolDefaultStyleUpdateFromAnnotationPopupEnabled(state)\r\n  ]);\r\n\r\n  const dispatch = useDispatch();\r\n  const [t] = useTranslation();\r\n\r\n  const adjustFreeTextBoundingBox = (annotation) => {\r\n    const { FreeTextAnnotation } = window.Core.Annotations;\r\n    if (annotation instanceof FreeTextAnnotation && annotation.getAutoSizeType() !== FreeTextAnnotation.AutoSizeTypes.NONE) {\r\n      const doc = core.getDocument();\r\n      const pageNumber = annotation['PageNumber'];\r\n      const pageInfo = doc.getPageInfo(pageNumber);\r\n      const pageMatrix = doc.getPageMatrix(pageNumber);\r\n      const pageRotation = doc.getPageRotation(pageNumber);\r\n      annotation.fitText(pageInfo, pageMatrix, pageRotation);\r\n    }\r\n  };\r\n\r\n  const handleSliderChange = (property, value) => {\r\n    const annotationManager = core.getAnnotationManager();\r\n    annotations.forEach((annotation) => {\r\n      annotation[property] = value;\r\n      annotationManager.redrawAnnotation(annotation);\r\n    });\r\n  };\r\n\r\n  const handlePropertyChange = (property, value) => {\r\n    annotations.forEach((annotation) => {\r\n      core.setAnnotationStyles(annotation, {\r\n        [property]: value,\r\n      });\r\n      if (isToolDefaultStyleUpdateFromAnnotationPopupEnabled) {\r\n        setToolStyles(annotation.ToolName, property, value);\r\n      }\r\n      if (property === 'FontSize' || property === 'Font') {\r\n        adjustFreeTextBoundingBox(annotation);\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleStyleChange = (property, value) => {\r\n    annotations.forEach((annotation) => {\r\n      core.setAnnotationStyles(annotation, {\r\n        [property]: value,\r\n      });\r\n\r\n      if (isToolDefaultStyleUpdateFromAnnotationPopupEnabled) {\r\n        setToolStyles(annotation.ToolName, property, value);\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleRichTextStyleChange = (property, value) => {\r\n    annotations.forEach((annotation) => {\r\n      core.updateAnnotationRichTextStyle(annotation, { [property]: value });\r\n    });\r\n  };\r\n\r\n  const handleLineStyleChange = (section, value) => {\r\n    annotations.forEach((annotation) => {\r\n      let lineStyle = '';\r\n      if (section === 'start') {\r\n        annotation.setStartStyle(value);\r\n        lineStyle = 'StartLineStyle';\r\n      } else if (section === 'end') {\r\n        annotation.setEndStyle(value);\r\n        lineStyle = 'EndLineStyle';\r\n      } else if (section === 'middle') {\r\n        const dashes = value.split(',');\r\n        const style = dashes.shift();\r\n        annotation['Style'] = style;\r\n        annotation['Dashes'] = dashes;\r\n        lineStyle = 'StrokeStyle';\r\n      }\r\n\r\n      if (isToolDefaultStyleUpdateFromAnnotationPopupEnabled) {\r\n        setToolStyles(annotation.ToolName, lineStyle, value);\r\n      }\r\n\r\n      core.getAnnotationManager().redrawAnnotation(annotation);\r\n    });\r\n\r\n    core.getAnnotationManager().trigger('annotationChanged', [annotations, 'modify', {}]);\r\n  };\r\n\r\n  const handleClick = (e) => {\r\n    if (isMobile() && e.target === e.currentTarget) {\r\n      dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n    }\r\n  };\r\n\r\n  const handleResize = () => {\r\n    onResize && onResize();\r\n  };\r\n\r\n  const className = getClassName('Popup AnnotationStylePopup', props);\r\n\r\n  return isDisabled ? null : (\r\n    <Measure\r\n      onResize={handleResize}\r\n    >\r\n      {({ measureRef }) => (\r\n        <div\r\n          className={className}\r\n          data-element={DataElements.ANNOTATION_STYLE_POPUP}\r\n          onClick={handleClick}\r\n          ref={measureRef}\r\n        >\r\n          {hasBackToMenu &&\r\n            <div\r\n              className=\"back-to-menu-container\"\r\n              data-element={DataElements.ANNOTATION_STYLE_POPUP_BACK_BUTTON_CONTAINER}\r\n            >\r\n              <ActionButton\r\n                className=\"back-to-menu-button\"\r\n                dataElement={DataElements.ANNOTATION_STYLE_POPUP_BACK_BUTTON}\r\n                label={t('action.backToMenu')}\r\n                img=\"icon-chevron-left\"\r\n                onClick={onBackToMenu}\r\n              />\r\n            </div>\r\n          }\r\n          {/* Do not show checkbox for ellipse as snap mode does not exist for it */}\r\n          <StylePopup\r\n            hideSnapModeCheckbox={hideSnapModeCheckbox}\r\n            colorMapKey={colorMapKey}\r\n            style={style}\r\n            isFreeText={isFreeText}\r\n            isEllipse={isEllipse}\r\n            isMeasure={isMeasure}\r\n            onStyleChange={handleStyleChange}\r\n            onSliderChange={handleSliderChange}\r\n            onPropertyChange={handlePropertyChange}\r\n            disableSeparator\r\n            properties={properties}\r\n            onRichTextStyleChange={handleRichTextStyleChange}\r\n            isRedaction={isRedaction}\r\n            showLineStyleOptions={showLineStyleOptions}\r\n            onLineStyleChange={handleLineStyleChange}\r\n          />\r\n        </div>\r\n      )}\r\n    </Measure>\r\n  );\r\n};\r\n\r\nAnnotationStylePopup.propTypes = propTypes;\r\n\r\nexport default AnnotationStylePopup;\r\n","import AnnotationStylePopup from './AnnotationStylePopup';\r\n\r\nexport default AnnotationStylePopup;","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./AnnotationPopup.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function (styleTag) {\r\n                const webComponents = document.getElementsByTagName('apryse-webviewer');\r\n                if (webComponents.length > 0) {\r\n                  const clonedStyleTags = [];\r\n                  for (let i = 0; i < webComponents.length; i++) {\r\n                    const webComponent = webComponents[i];\r\n                    if (i === 0) {\r\n                      webComponent.shadowRoot.appendChild(styleTag);\r\n                      styleTag.onload = function () {\r\n                        if (clonedStyleTags.length > 0) {\r\n                          clonedStyleTags.forEach((styleNode) => {\r\n                            // eslint-disable-next-line no-unsanitized/property\r\n                            styleNode.innerHTML = styleTag.innerHTML;\r\n                          });\r\n                        }\r\n                      };\r\n                    } else {\r\n                      const styleNode = styleTag.cloneNode(true);\r\n                      webComponent.shadowRoot.appendChild(styleNode);\r\n                      clonedStyleTags.push(styleNode);\r\n                    }\r\n                  }\r\n                } else {\r\n                  document.head.appendChild(styleTag);\r\n                }\r\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/postcss-loader/src/index.js??postcss!../../../../../node_modules/sass-loader/dist/cjs.js!./CalibrationPopup.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = function (styleTag) {\r\n                const webComponents = document.getElementsByTagName('apryse-webviewer');\r\n                if (webComponents.length > 0) {\r\n                  const clonedStyleTags = [];\r\n                  for (let i = 0; i < webComponents.length; i++) {\r\n                    const webComponent = webComponents[i];\r\n                    if (i === 0) {\r\n                      webComponent.shadowRoot.appendChild(styleTag);\r\n                      styleTag.onload = function () {\r\n                        if (clonedStyleTags.length > 0) {\r\n                          clonedStyleTags.forEach((styleNode) => {\r\n                            // eslint-disable-next-line no-unsanitized/property\r\n                            styleNode.innerHTML = styleTag.innerHTML;\r\n                          });\r\n                        }\r\n                      };\r\n                    } else {\r\n                      const styleNode = styleTag.cloneNode(true);\r\n                      webComponent.shadowRoot.appendChild(styleNode);\r\n                      clonedStyleTags.push(styleNode);\r\n                    }\r\n                  }\r\n                } else {\r\n                  document.head.appendChild(styleTag);\r\n                }\r\n              };\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \":host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}@-webkit-keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@-webkit-keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}.CalibrationPopup{display:flex;flex-direction:column;align-items:flex-start;padding:12px;width:220px;height:84px;background:#fff;box-shadow:0 0 3px #868e96;border-radius:4px}.CalibrationPopup .pop-switch{margin-top:12px}.CalibrationPopup .pop-switch.ui__choice--disabled .ui__choice__label{color:#cfd4da}.CalibrationPopup .input-container{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start;width:196px;height:32px}.CalibrationPopup .input-container .input-field{width:94px;height:32px}.CalibrationPopup .input-container .input-field.invalid-value{border-color:red}.CalibrationPopup .input-container .input-field .Dropdown__wrapper{width:100%;height:100%}.CalibrationPopup .input-container .input-field .Dropdown__wrapper .Dropdown{height:100%;text-align:left}.CalibrationPopup .input-container .input-field .Dropdown__wrapper .Dropdown__items{width:100%}\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"LEFT_HEADER_WIDTH\": \"41px\",\n\t\"RIGHT_HEADER_WIDTH\": \"41px\"\n};","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".open.AnnotationPopup{visibility:visible}.closed.AnnotationPopup{visibility:hidden}:host{display:inline-block;container-type:inline-size;width:100%;height:100%;overflow:hidden}@media(min-width:901px){.App:not(.is-web-component) .hide-in-desktop{display:none}}@container (min-width: 901px){.hide-in-desktop{display:none}}@media(min-width:641px)and (max-width:900px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .hide-in-tablet{display:none}}@container (min-width: 641px) and (max-width: 900px){.App.is-web-component:not(.is-in-desktop-only-mode) .hide-in-tablet{display:none}}@media(max-width:640px)and (min-width:431px){.App:not(.is-web-component) .hide-in-mobile{display:none}}@container (max-width: 640px) and (min-width: 431px){.App.is-web-component .hide-in-mobile{display:none}}@media(max-width:430px){.App:not(.is-web-component) .hide-in-small-mobile{display:none}}@container (max-width: 430px){.App.is-web-component .hide-in-small-mobile{display:none}}.always-hide{display:none}.AnnotationPopup{position:absolute;z-index:70;display:flex;justify-content:center;align-items:center}.AnnotationPopup:empty{padding:0}.AnnotationPopup .buttons{display:flex}.AnnotationPopup .Button{margin:4px;width:32px;height:32px}@media(max-width:640px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .AnnotationPopup .Button{width:42px;height:42px}}@container (max-width: 640px){.App.is-web-component:not(.is-in-desktop-only-mode) .AnnotationPopup .Button{width:42px;height:42px}}.AnnotationPopup .Button:hover{background:var(--popup-button-hover)}.AnnotationPopup .Button .Icon{width:18px;height:18px}@media(max-width:640px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .AnnotationPopup .Button .Icon{width:24px;height:24px}}@container (max-width: 640px){.App.is-web-component:not(.is-in-desktop-only-mode) .AnnotationPopup .Button .Icon{width:24px;height:24px}}.is-vertical.AnnotationPopup .Button.main-menu-button{width:100%;border-radius:0;justify-content:flex-start;padding-left:var(--padding-small);padding-right:var(--padding-small);margin:0 0 var(--padding-tiny) 0}.is-vertical.AnnotationPopup .Button.main-menu-button:first-child{margin-top:var(--padding-tiny)}@media(max-width:640px){.App:not(.is-in-desktop-only-mode):not(.is-web-component) .is-vertical.AnnotationPopup .Button.main-menu-button{width:100%;height:32px}}@container (max-width: 640px){.App.is-web-component:not(.is-in-desktop-only-mode) .is-vertical.AnnotationPopup .Button.main-menu-button{width:100%;height:32px}}.is-vertical.AnnotationPopup .Button.main-menu-button .Icon{margin-right:10px}.is-vertical.AnnotationPopup .Button.main-menu-button span{white-space:nowrap}@-webkit-keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes bottom-up{0%{transform:translateY(100%)}to{transform:translateY(0)}}@-webkit-keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes up-bottom{0%{transform:translateY(0)}to{transform:translateY(100%)}}.AnnotationPopup{position:fixed;border-radius:4px;box-shadow:0 0 3px 0 var(--document-box-shadow);background:var(--component-background)}.AnnotationPopup.is-horizontal .container{display:inherit}.AnnotationPopup.is-vertical{flex-direction:column;align-items:flex-start}.shortCuts3D{position:relative}.shortCuts3D .closeButton{position:absolute;right:4px;padding:2px;cursor:pointer;width:20px;text-align:center}.shortCuts3D .row{padding:4px 0;margin:8px 26px 8px 16px}.shortCuts3D .row span{background:#e7ebee;padding:4px 8px;border-radius:4px}\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"LEFT_HEADER_WIDTH\": \"41px\",\n\t\"RIGHT_HEADER_WIDTH\": \"41px\"\n};","import React, { useRef, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst DatePicker = ({ onClick, annotation, onDatePickerShow }) => {\r\n  const dateRef = useRef(null);\r\n  const dateContainerRef = useRef(null);\r\n  useEffect(() => {\r\n    let datePicker;\r\n    const getDatePicker = async () => {\r\n      datePicker = await window.Core.createDatePicker({\r\n        field: dateRef.current,\r\n        onClick,\r\n        container: dateContainerRef.current,\r\n        format: annotation.getDateFormat(),\r\n      });\r\n      onDatePickerShow(true);\r\n    };\r\n    getDatePicker();\r\n\r\n    return () => {\r\n      datePicker.destroy();\r\n      datePicker = null;\r\n      onDatePickerShow(false);\r\n    };\r\n  }, []);\r\n  return (\r\n    <div data-element=\"datePickerContainer\">\r\n      <div ref={dateRef} />\r\n      <div ref={dateContainerRef}/>\r\n    </div>\r\n  );\r\n};\r\n\r\nDatePicker.propTypes = {\r\n  onClick: PropTypes.func.isRequired,\r\n  annotation: PropTypes.object.isRequired,\r\n  onDatePickerShow: PropTypes.func.isRequired\r\n};\r\n\r\nexport default DatePicker;\r\n","import DatePicker from './DatePicker';\r\n\r\nexport default DatePicker;","import React, { useState, useEffect, useRef } from 'react';\r\nimport selectors from 'selectors';\r\nimport { useSelector, useDispatch, shallowEqual } from 'react-redux';\r\nimport core from 'core';\r\nimport actions from 'actions';\r\nimport { Choice } from '@pdftron/webviewer-react-toolkit';\r\nimport Dropdown from '../Dropdown';\r\nimport Tooltip from '../Tooltip';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  metricUnits,\r\n  convertUnit,\r\n  fractionalUnits,\r\n  floatRegex,\r\n  inFractionalRegex,\r\n  ftInFractionalRegex,\r\n  ftInDecimalRegex,\r\n  parseFtInDecimal,\r\n  parseInFractional,\r\n  parseFtInFractional,\r\n  hintValues\r\n} from 'constants/measurementScale';\r\nimport classNames from 'classnames';\r\n\r\nimport './CalibrationPopup.scss';\r\n\r\nconst Scale = window.Core.Scale;\r\n\r\nconst parseMeasurementContentsByAnnotation = (annotation) => {\r\n  const factor = annotation.Measure.axis[0].factor;\r\n  const unit = annotation.Scale[1][1];\r\n\r\n  switch (unit) {\r\n    case 'ft-in':\r\n      return (annotation.getLineLength() * factor) / 12;\r\n    case 'in':\r\n    default:\r\n      return annotation.getLineLength() * factor;\r\n  }\r\n};\r\n\r\nconst getDefaultPageUnit = (pageUnit) => {\r\n  if (pageUnit === 'pt') {\r\n    return 'pt';\r\n  }\r\n  if (metricUnits.includes(pageUnit)) {\r\n    return 'mm';\r\n  }\r\n  return 'in';\r\n};\r\n\r\nconst CalibrationPropType = {\r\n  annotation: PropTypes.shape({\r\n    Scale: PropTypes.arrayOf(PropTypes.array),\r\n  }),\r\n};\r\n\r\nconst CalibrationPopup = ({ annotation }) => {\r\n  const [t] = useTranslation();\r\n  const dispatch = useDispatch();\r\n\r\n  const [\r\n    measurementUnits,\r\n    { tempScale, isFractionalUnit, defaultUnit }\r\n  ] = useSelector((state) => [\r\n    selectors.getMeasurementUnits(state),\r\n    selectors.getCalibrationInfo(state)\r\n  ], shallowEqual);\r\n  const [valueDisplay, setValueDisplay] = useState('');\r\n  const inputRef = useRef(null);\r\n\r\n  const unitTo = new Scale(tempScale).worldScale?.unit || 'mm';\r\n  const unitToOptions = isFractionalUnit ? measurementUnits.to.filter((unit) => fractionalUnits.includes(unit)) : measurementUnits.to;\r\n  const isFractionalUnitsToggleDisabled = !fractionalUnits.includes(unitTo);\r\n  const valueInputType = (isFractionalUnit || unitTo === 'ft-in') ? 'text' : 'number';\r\n  const inputValueClass = classNames('input-field', {\r\n    'invalid-value': !(tempScale && new Scale(tempScale).worldScale?.value > 0)\r\n  });\r\n\r\n  const updateTempScale = (scaleValue, scaleUnit) => {\r\n    const currentDistance = parseMeasurementContentsByAnnotation(annotation);\r\n    const currentScale = annotation.Scale;\r\n    const newRatio = currentDistance / currentScale[1][0];\r\n    const pageScale = [currentScale[0][0] * newRatio, currentScale[0][1]];\r\n    const defaultPageUnit = getDefaultPageUnit(scaleUnit);\r\n    const defaultPageValue = convertUnit(pageScale[0], pageScale[1], defaultPageUnit);\r\n    dispatch(actions.updateCalibrationInfo({ tempScale: `${defaultPageValue} ${defaultPageUnit} = ${scaleValue} ${scaleUnit}`, isFractionalUnit }));\r\n  };\r\n\r\n  const setValue = (scaleValue) => {\r\n    updateTempScale(scaleValue, new Scale(tempScale).worldScale?.unit);\r\n  };\r\n\r\n  const setUnitTo = (scaleUnit) => {\r\n    updateTempScale(new Scale(tempScale).worldScale?.value, scaleUnit);\r\n  };\r\n\r\n  const toggleFractionalUnits = () => {\r\n    dispatch(actions.updateCalibrationInfo({ tempScale, isFractionalUnit: !isFractionalUnit }));\r\n  };\r\n\r\n  const onValueInputChange = (e) => {\r\n    setValueDisplay(e.target.value);\r\n    const inputValue = e.target.value.trim();\r\n    if (!isFractionalUnit) {\r\n      if (unitTo === 'ft-in' && ftInDecimalRegex.test(inputValue)) {\r\n        const result = parseFtInDecimal(inputValue);\r\n        if (result > 0) {\r\n          setValue(result);\r\n          return;\r\n        }\r\n      } else if (floatRegex.test(inputValue)) {\r\n        const result = parseFloat(inputValue) || 0;\r\n        setValue(result);\r\n        return;\r\n      }\r\n    } else {\r\n      if (unitTo === 'in') {\r\n        if (inFractionalRegex.test(inputValue)) {\r\n          const result = parseInFractional(inputValue);\r\n          if (result > 0) {\r\n            setValue(result);\r\n            return;\r\n          }\r\n        }\r\n      } else if (unitTo === 'ft-in') {\r\n        if (ftInFractionalRegex.test(inputValue)) {\r\n          const result = parseFtInFractional(inputValue);\r\n          if (result > 0) {\r\n            setValue(result);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    setValue(0);\r\n  };\r\n\r\n  const onValueInputBlur = () => {\r\n    updateValueDisplay();\r\n  };\r\n\r\n  const updateValueDisplay = () => {\r\n    const scaleValue = new Scale(tempScale).worldScale?.value;\r\n    let newValueDisplay;\r\n    if (!isFractionalUnit && unitTo !== 'ft-in') {\r\n      newValueDisplay = `${scaleValue}`;\r\n    } else {\r\n      newValueDisplay = Scale.getFormattedValue(scaleValue, unitTo, isFractionalUnit ? 1 / 64 : 0.0001, false, true);\r\n    }\r\n    setValueDisplay(newValueDisplay || '');\r\n  };\r\n\r\n  const tempScaleRef = useRef(tempScale);\r\n  useEffect(() => {\r\n    tempScaleRef.current = tempScale;\r\n  }, [tempScale]);\r\n  useEffect(() => {\r\n    if (annotation) {\r\n      const value = parseMeasurementContentsByAnnotation(annotation);\r\n      const unit = annotation.Scale[1][1];\r\n      if (defaultUnit) {\r\n        updateTempScale(convertUnit(value, unit, defaultUnit), defaultUnit);\r\n      } else {\r\n        updateTempScale(value, unit);\r\n      }\r\n    }\r\n\r\n    const onAnnotationChanged = (annotations, action) => {\r\n      if (action === 'modify' && annotations.length === 1 && annotations[0] === annotation) {\r\n        const value = parseMeasurementContentsByAnnotation(annotation);\r\n        const unit = annotation.Scale[1][1];\r\n        const currentUnit = new Scale(tempScaleRef.current).worldScale?.unit;\r\n        if (currentUnit) {\r\n          updateTempScale(convertUnit(value, unit, currentUnit), currentUnit);\r\n        } else {\r\n          updateTempScale(value, unit);\r\n        }\r\n      }\r\n    };\r\n    core.addEventListener('annotationChanged', onAnnotationChanged);\r\n\r\n    return () => {\r\n      core.removeEventListener('annotationChanged', onAnnotationChanged);\r\n      core.deleteAnnotations([annotation]);\r\n    };\r\n  }, [annotation]);\r\n\r\n  useEffect(() => {\r\n    if (inputRef?.current !== document.activeElement) {\r\n      updateValueDisplay();\r\n    }\r\n  }, [tempScale, isFractionalUnit]);\r\n\r\n  return (\r\n    <div className=\"CalibrationPopup\" data-element=\"calibrationPopup\">\r\n      <div className=\"input-container\">\r\n        <input\r\n          className={inputValueClass}\r\n          ref={inputRef}\r\n          type={valueInputType}\r\n          value={valueDisplay}\r\n          min='0'\r\n          onChange={onValueInputChange}\r\n          onBlur={onValueInputBlur}\r\n          placeholder={isFractionalUnit ? hintValues[unitTo] : (unitTo === 'ft-in' ? hintValues['ft-in decimal'] : '')}\r\n        />\r\n        <Tooltip content={'option.measurement.scaleModal.displayUnits'}>\r\n          <div className=\"input-field\">\r\n            <Dropdown\r\n              dataElement=\"calibrationUnits\"\r\n              items={unitToOptions}\r\n              currentSelectionKey={unitTo}\r\n              onClickItem={setUnitTo}\r\n            />\r\n          </div>\r\n        </Tooltip>\r\n      </div>\r\n      <Tooltip content={t('option.measurement.scaleModal.fractionUnitsTooltip')}>\r\n        <div>\r\n          <Choice\r\n            isSwitch\r\n            leftLabel\r\n            label={t('option.measurement.scaleModal.fractionalUnits')}\r\n            disabled={isFractionalUnitsToggleDisabled}\r\n            checked={isFractionalUnit}\r\n            id=\"calibration-popup-fractional-units\"\r\n            className=\"pop-switch\"\r\n            onChange={toggleFractionalUnits}\r\n          />\r\n        </div>\r\n      </Tooltip>\r\n    </div>\r\n  );\r\n};\r\n\r\nCalibrationPopup.propTypes = CalibrationPropType;\r\n\r\nexport default CalibrationPopup;\r\n","import CalibrationPopup from './CalibrationPopup';\r\n\r\nexport default CalibrationPopup;","import React, { useState } from 'react';\r\nimport Draggable from 'react-draggable';\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { FocusTrap } from '@pdftron/webviewer-react-toolkit';\r\n\r\nimport ActionButton from 'components/ActionButton';\r\nimport AnnotationStylePopup from 'components/AnnotationStylePopup';\r\nimport DatePicker from 'components/DatePicker';\r\nimport CustomizablePopup from 'components/CustomizablePopup';\r\nimport CalibrationPopup from 'components/CalibrationPopup';\r\n\r\nimport { getDataWithKey, mapToolNameToKey, mapAnnotationToKey } from 'constants/map';\r\n\r\nimport DataElements from 'constants/dataElement';\r\n\r\nimport './AnnotationPopup.scss';\r\nimport getRootNode from 'helpers/getRootNode';\r\n\r\nconst propTypes = {\r\n  isMobile: PropTypes.bool,\r\n  isIE: PropTypes.bool,\r\n  isOpen: PropTypes.bool,\r\n  isRightClickMenu: PropTypes.bool,\r\n  isNotesPanelOpenOrActive: PropTypes.bool,\r\n  isRichTextPopupOpen: PropTypes.bool,\r\n  isLinkModalOpen: PropTypes.bool,\r\n  isContextMenuPopupOpen: PropTypes.bool,\r\n\r\n  focusedAnnotation: PropTypes.object,\r\n  popupRef: PropTypes.any,\r\n  position: PropTypes.object,\r\n\r\n  showViewFileButton: PropTypes.bool,\r\n  onViewFile: PropTypes.func,\r\n\r\n  showCommentButton: PropTypes.bool,\r\n  onCommentAnnotation: PropTypes.func,\r\n  isDateFreeTextCanEdit: PropTypes.bool,\r\n  isDatePickerOpen: PropTypes.bool,\r\n  handleDateChange: PropTypes.func,\r\n  onDatePickerShow: PropTypes.func,\r\n  isCalibrationPopupOpen: PropTypes.bool,\r\n\r\n  showEditStyleButton: PropTypes.bool,\r\n  isStylePopupOpen: PropTypes.bool,\r\n  hideSnapModeCheckbox: PropTypes.bool,\r\n  openEditStylePopup: PropTypes.func,\r\n  closeEditStylePopup: PropTypes.func,\r\n  annotationStyle: PropTypes.object,\r\n  onResize: PropTypes.func,\r\n\r\n  showContentEditButton: PropTypes.bool,\r\n  onEditContent: PropTypes.func,\r\n  openContentEditDeleteWarningModal: PropTypes.func,\r\n\r\n  isAppearanceSignature: PropTypes.bool,\r\n  onClearAppearanceSignature: PropTypes.func,\r\n\r\n  showRedactionButton: PropTypes.bool,\r\n  onApplyRedaction: PropTypes.func,\r\n\r\n  showGroupButton: PropTypes.bool,\r\n  onGroupAnnotations: PropTypes.func,\r\n  showUngroupButton: PropTypes.bool,\r\n  onUngroupAnnotations: PropTypes.func,\r\n\r\n  showFormFieldButton: PropTypes.bool,\r\n  onOpenFormField: PropTypes.func,\r\n\r\n  showDeleteButton: PropTypes.bool,\r\n  onDeleteAnnotation: PropTypes.func,\r\n\r\n  showLinkButton: PropTypes.bool,\r\n  hasAssociatedLink: PropTypes.bool,\r\n  linkAnnotationToURL: PropTypes.func,\r\n\r\n  showFileDownloadButton: PropTypes.bool,\r\n  downloadFileAttachment: PropTypes.func,\r\n\r\n  showAudioPlayButton: PropTypes.bool,\r\n  handlePlaySound: PropTypes.func,\r\n\r\n  showCalibrateButton: PropTypes.bool,\r\n  onOpenCalibration: PropTypes.func,\r\n};\r\n\r\nconst AnnotationPopup = ({\r\n  isMobile,\r\n  isIE,\r\n  isOpen,\r\n  isRightClickMenu,\r\n  isNotesPanelOpenOrActive,\r\n  isRichTextPopupOpen,\r\n  isLinkModalOpen,\r\n  isContextMenuPopupOpen,\r\n\r\n  focusedAnnotation,\r\n  popupRef,\r\n  position,\r\n\r\n  showViewFileButton,\r\n  onViewFile,\r\n\r\n  showCommentButton,\r\n  onCommentAnnotation,\r\n  isDateFreeTextCanEdit,\r\n  isDatePickerOpen,\r\n  handleDateChange,\r\n  onDatePickerShow,\r\n  isCalibrationPopupOpen,\r\n\r\n  showEditStyleButton,\r\n  isStylePopupOpen,\r\n  hideSnapModeCheckbox,\r\n  openEditStylePopup,\r\n  closeEditStylePopup,\r\n  annotationStyle,\r\n  onResize,\r\n\r\n  showContentEditButton,\r\n  onEditContent,\r\n  openContentEditDeleteWarningModal,\r\n\r\n  isAppearanceSignature,\r\n  onClearAppearanceSignature,\r\n\r\n  showRedactionButton,\r\n  onApplyRedaction,\r\n\r\n  showGroupButton,\r\n  onGroupAnnotations,\r\n  showUngroupButton,\r\n  onUngroupAnnotations,\r\n\r\n  showFormFieldButton,\r\n  onOpenFormField,\r\n\r\n  showDeleteButton,\r\n  onDeleteAnnotation,\r\n\r\n  showLinkButton,\r\n  hasAssociatedLink,\r\n  linkAnnotationToURL,\r\n\r\n  showFileDownloadButton,\r\n  downloadFileAttachment,\r\n\r\n  showAudioPlayButton,\r\n  handlePlaySound,\r\n\r\n  showCalibrateButton,\r\n  onOpenCalibration,\r\n}) => {\r\n  const [t] = useTranslation();\r\n  const [shortCutKeysFor3DVisible, setShortCutKeysFor3DVisible] = useState(false);\r\n\r\n  const commentButtonLabel = isDateFreeTextCanEdit ? 'action.changeDate' : 'action.comment';\r\n  const commentButtonImg = isDateFreeTextCanEdit ? 'icon-tool-fill-and-sign-calendar' : 'icon-header-chat-line';\r\n\r\n  const show3DShortCutButton = focusedAnnotation instanceof window.Core.Annotations.Model3DAnnotation && !isMobile;\r\n  const isRectangle = focusedAnnotation instanceof window.Core.Annotations.RectangleAnnotation;\r\n  const isEllipse = focusedAnnotation instanceof window.Core.Annotations.EllipseAnnotation;\r\n  const isPolygon = focusedAnnotation instanceof window.Core.Annotations.PolygonAnnotation;\r\n  const isFreeText =\r\n    focusedAnnotation instanceof window.Core.Annotations.FreeTextAnnotation &&\r\n    (focusedAnnotation.getIntent() === window.Core.Annotations.FreeTextAnnotation.Intent.FreeText ||\r\n      focusedAnnotation.getIntent() === window.Core.Annotations.FreeTextAnnotation.Intent.FreeTextCallout);\r\n  const isRedaction = focusedAnnotation instanceof window.Core.Annotations.RedactionAnnotation;\r\n  const colorMapKey = mapAnnotationToKey(focusedAnnotation);\r\n  const isMeasure = !!focusedAnnotation.Measure;\r\n  const showLineStyleOptions = getDataWithKey(mapToolNameToKey(focusedAnnotation.ToolName)).hasLineEndings;\r\n  const isInstanceActive = !window.isApryseWebViewerWebComponent || document.activeElement?.shadowRoot === getRootNode();\r\n  let StrokeStyle = 'solid';\r\n  const isContentEdit = focusedAnnotation.isContentEditPlaceholder?.();\r\n\r\n  try {\r\n    StrokeStyle = (focusedAnnotation['Style'] === 'dash')\r\n      ? `${focusedAnnotation['Style']},${focusedAnnotation['Dashes']}`\r\n      : focusedAnnotation['Style'];\r\n  } catch (err) {\r\n    console.error(err);\r\n  }\r\n  let properties = {};\r\n  if (showLineStyleOptions) {\r\n    properties = {\r\n      StartLineStyle: focusedAnnotation.getStartStyle(),\r\n      EndLineStyle: focusedAnnotation.getEndStyle(),\r\n      StrokeStyle,\r\n    };\r\n  }\r\n\r\n  if (isRectangle || isEllipse || isPolygon) {\r\n    properties = {\r\n      StrokeStyle,\r\n    };\r\n  }\r\n\r\n  if (isFreeText) {\r\n    const richTextStyles = focusedAnnotation.getRichTextStyle();\r\n    properties = {\r\n      Font: focusedAnnotation.Font,\r\n      FontSize: focusedAnnotation.FontSize,\r\n      TextAlign: focusedAnnotation.TextAlign,\r\n      TextVerticalAlign: focusedAnnotation.TextVerticalAlign,\r\n      bold: richTextStyles?.[0]?.['font-weight'] === 'bold' ?? false,\r\n      italic: richTextStyles?.[0]?.['font-style'] === 'italic' ?? false,\r\n      underline: richTextStyles?.[0]?.['text-decoration']?.includes('underline') || richTextStyles?.[0]?.['text-decoration']?.includes('word'),\r\n      strikeout: richTextStyles?.[0]?.['text-decoration']?.includes('line-through') ?? false,\r\n      StrokeStyle,\r\n    };\r\n  }\r\n\r\n  if (isRedaction) {\r\n    properties = {\r\n      OverlayText: focusedAnnotation['OverlayText'],\r\n      Font: focusedAnnotation['Font'],\r\n      FontSize: focusedAnnotation['FontSize'],\r\n      TextAlign: focusedAnnotation['TextAlign']\r\n    };\r\n  }\r\n\r\n  const renderPopup = () => {\r\n    switch (true) {\r\n      case isStylePopupOpen:\r\n        return (\r\n          <AnnotationStylePopup\r\n            annotations={[focusedAnnotation]}\r\n            style={annotationStyle}\r\n            isOpen={isOpen}\r\n            onResize={onResize}\r\n            isFreeText={isFreeText}\r\n            isEllipse={isEllipse}\r\n            isRedaction={isRedaction}\r\n            isMeasure={isMeasure}\r\n            colorMapKey={colorMapKey}\r\n            showLineStyleOptions={showLineStyleOptions}\r\n            properties={properties}\r\n            hideSnapModeCheckbox={hideSnapModeCheckbox}\r\n            hasBackToMenu={isRightClickMenu}\r\n            onBackToMenu={closeEditStylePopup}\r\n          />\r\n        );\r\n      case isDatePickerOpen:\r\n        return (\r\n          <DatePicker onClick={handleDateChange} annotation={focusedAnnotation} onDatePickerShow={onDatePickerShow} />\r\n        );\r\n      case isCalibrationPopupOpen:\r\n        return <CalibrationPopup annotation={focusedAnnotation} />;\r\n      case shortCutKeysFor3DVisible && focusedAnnotation instanceof window.Core.Annotations.Model3DAnnotation:\r\n        return (\r\n          <div className=\"shortCuts3D\">\r\n            <div className=\"closeButton\" onClick={() => setShortCutKeysFor3DVisible(false)}>x</div>\r\n            <div className=\"row\">{t('action.rotate3D')} <span>{t('shortcut.rotate3D')}</span></div>\r\n            <div className=\"row\">{t('action.zoom')} <span>{t('shortcut.zoom3D')}</span></div>\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <FocusTrap\r\n            locked={isOpen && isInstanceActive && !isRichTextPopupOpen && !isNotesPanelOpenOrActive && !isLinkModalOpen && !isFreeText && !isContextMenuPopupOpen}\r\n          >\r\n            <div className=\"container\">\r\n              <CustomizablePopup\r\n                dataElement={DataElements.ANNOTATION_POPUP}\r\n                childrenClassName='main-menu-button'\r\n              >\r\n                {showViewFileButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"viewFileButton\"\r\n                    label={isRightClickMenu ? 'action.viewFile' : ''}\r\n                    title={!isRightClickMenu ? 'action.viewFile' : ''}\r\n                    img=\"icon-view\"\r\n                    onClick={onViewFile}\r\n                  />\r\n                )}\r\n                {showCommentButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationCommentButton\"\r\n                    label={isRightClickMenu ? commentButtonLabel : ''}\r\n                    title={!isRightClickMenu ? commentButtonLabel : ''}\r\n                    img={commentButtonImg}\r\n                    onClick={onCommentAnnotation}\r\n                  />\r\n                )}\r\n                {showEditStyleButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationStyleEditButton\"\r\n                    label={isRightClickMenu ? 'action.style' : ''}\r\n                    title={!isRightClickMenu ? 'action.style' : ''}\r\n                    img=\"icon-menu-style-line\"\r\n                    onClick={openEditStylePopup}\r\n                  />\r\n                )}\r\n                {showContentEditButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationContentEditButton\"\r\n                    label={isRightClickMenu ? 'action.edit' : ''}\r\n                    title={!isRightClickMenu ? 'action.edit' : ''}\r\n                    img=\"ic_edit_page_24px\"\r\n                    onClick={onEditContent}\r\n                  />\r\n                )}\r\n                {isAppearanceSignature && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationClearSignatureButton\"\r\n                    label={isRightClickMenu ? 'action.clearSignature' : ''}\r\n                    title={!isRightClickMenu ? 'action.clearSignature' : ''}\r\n                    img=\"icon-delete-line\"\r\n                    onClick={onClearAppearanceSignature}\r\n                  />\r\n                )}\r\n                {showRedactionButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationRedactButton\"\r\n                    label={isRightClickMenu ? 'action.apply' : ''}\r\n                    title={!isRightClickMenu ? 'action.apply' : ''}\r\n                    img=\"ic_check_black_24px\"\r\n                    onClick={onApplyRedaction}\r\n                  />\r\n                )}\r\n                {showGroupButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationGroupButton\"\r\n                    label={isRightClickMenu ? 'action.group' : ''}\r\n                    title={!isRightClickMenu ? 'action.group' : ''}\r\n                    img=\"group-annotations-icon\"\r\n                    onClick={onGroupAnnotations}\r\n                  />\r\n                )}\r\n                {showUngroupButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationUngroupButton\"\r\n                    label={isRightClickMenu ? 'action.ungroup' : ''}\r\n                    title={!isRightClickMenu ? 'action.ungroup' : ''}\r\n                    img=\"ungroup-annotations-icon\"\r\n                    onClick={onUngroupAnnotations}\r\n                  />\r\n                )}\r\n                {showFormFieldButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"formFieldEditButton\"\r\n                    label={isRightClickMenu ? 'action.formFieldEdit' : ''}\r\n                    title={!isRightClickMenu ? 'action.formFieldEdit' : ''}\r\n                    img=\"icon-edit-form-field\"\r\n                    onClick={onOpenFormField}\r\n                  />\r\n                )}\r\n                {showDeleteButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"annotationDeleteButton\"\r\n                    label={isRightClickMenu ? 'action.delete' : ''}\r\n                    title={!isRightClickMenu ? 'action.delete' : ''}\r\n                    img=\"icon-delete-line\"\r\n                    onClick={isContentEdit ? openContentEditDeleteWarningModal : onDeleteAnnotation}\r\n                  />\r\n                )}\r\n                {showCalibrateButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement={DataElements.CALIBRATION_POPUP_BUTTON}\r\n                    label={isRightClickMenu ? 'action.calibrate' : ''}\r\n                    title={!isRightClickMenu ? 'action.calibrate' : ''}\r\n                    img=\"calibrate\"\r\n                    onClick={onOpenCalibration}\r\n                  />\r\n                )}\r\n                {showLinkButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"linkButton\"\r\n                    label={isRightClickMenu ? 'tool.Link' : ''}\r\n                    title={!isRightClickMenu ? 'tool.Link' : ''}\r\n                    img={hasAssociatedLink ? 'icon-tool-unlink' : 'icon-tool-link'}\r\n                    onClick={linkAnnotationToURL}\r\n                  />\r\n                )}\r\n                {showFileDownloadButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"fileAttachmentDownload\"\r\n                    label={isRightClickMenu ? 'action.fileAttachmentDownload' : ''}\r\n                    title={!isRightClickMenu ? 'action.fileAttachmentDownload' : ''}\r\n                    img=\"icon-download\"\r\n                    onClick={() => downloadFileAttachment(focusedAnnotation)}\r\n                  />\r\n                )}\r\n                {show3DShortCutButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"shortCutKeysFor3D\"\r\n                    label={isRightClickMenu ? 'action.viewShortCutKeysFor3D' : ''}\r\n                    title={!isRightClickMenu ? 'action.viewShortCutKeysFor3D' : ''}\r\n                    img=\"icon-keyboard\"\r\n                    onClick={() => setShortCutKeysFor3DVisible(true)}\r\n                  />\r\n                )}\r\n                {showAudioPlayButton && (\r\n                  <ActionButton\r\n                    className=\"main-menu-button\"\r\n                    dataElement=\"playSoundButton\"\r\n                    label={isRightClickMenu ? 'action.playAudio' : ''}\r\n                    title={!isRightClickMenu ? 'action.playAudio' : ''}\r\n                    img=\"ic_play_24px\"\r\n                    onClick={() => handlePlaySound(focusedAnnotation)}\r\n                  />\r\n                )}\r\n              </CustomizablePopup>\r\n            </div>\r\n          </FocusTrap>\r\n        );\r\n    }\r\n  };\r\n\r\n  const annotationPopup = (\r\n    <div\r\n      className={classNames({\r\n        Popup: true,\r\n        AnnotationPopup: true,\r\n        open: isOpen,\r\n        closed: !isOpen,\r\n        stylePopupOpen: isStylePopupOpen,\r\n        'is-vertical': isRightClickMenu,\r\n        'is-horizontal': !isRightClickMenu,\r\n      })}\r\n      ref={popupRef}\r\n      data-element={DataElements.ANNOTATION_POPUP}\r\n      style={{ ...position }}\r\n    >\r\n      {renderPopup()}\r\n    </div>\r\n  );\r\n\r\n  return isIE || isMobile ? (\r\n    annotationPopup\r\n  ) : (\r\n    <Draggable cancel=\".Button, .cell, .sliders-container svg, select, button, input\">{annotationPopup}</Draggable>\r\n  );\r\n};\r\n\r\nAnnotationPopup.propTypes = propTypes;\r\n\r\nexport default AnnotationPopup;\r\n","import React, { useState, useEffect, useRef, useCallback, useLayoutEffect } from 'react';\r\nimport { useSelector, useDispatch, shallowEqual } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport core from 'core';\r\nimport { getAnnotationPopupPositionBasedOn } from 'helpers/getPopupPosition';\r\nimport getAnnotationStyles from 'helpers/getAnnotationStyles';\r\nimport applyRedactions from 'helpers/applyRedactions';\r\nimport { isMobile, isIE } from 'helpers/device';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { getOpenedWarningModal, getOpenedColorPicker, getDatePicker } from 'helpers/getElements';\r\nimport getGroupedLinkAnnotations from 'helpers/getGroupedLinkAnnotations';\r\nimport getHashParameters from 'helpers/getHashParameters';\r\nimport useOnClickOutside from 'hooks/useOnClickOutside';\r\nimport actions from 'actions';\r\nimport selectors from 'selectors';\r\nimport DataElements from 'constants/dataElement';\r\nimport { PRIORITY_THREE } from 'constants/actionPriority';\r\nimport getRootNode from 'helpers/getRootNode';\r\n\r\nimport AnnotationPopup from './AnnotationPopup';\r\n\r\nimport './AnnotationPopup.scss';\r\n\r\nconst { ToolNames } = window.Core.Tools;\r\nconst { Annotations } = window.Core;\r\n\r\nconst propTypes = {\r\n  focusedAnnotation: PropTypes.object,\r\n  selectedMultipleAnnotations: PropTypes.bool,\r\n  canModify: PropTypes.bool,\r\n  isStylePopupOpen: PropTypes.bool,\r\n  setIsStylePopupOpen: PropTypes.func,\r\n  isDatePickerOpen: PropTypes.bool,\r\n  setDatePickerOpen: PropTypes.func,\r\n  isDatePickerMount: PropTypes.bool,\r\n  setDatePickerMount: PropTypes.func,\r\n  hasAssociatedLink: PropTypes.bool,\r\n  includesFormFieldAnnotation: PropTypes.bool,\r\n  stylePopupRepositionFlag: PropTypes.bool,\r\n  setStylePopupRepositionFlag: PropTypes.func,\r\n  closePopup: PropTypes.func,\r\n};\r\n\r\nconst AnnotationPopupContainer = ({\r\n  focusedAnnotation,\r\n  selectedMultipleAnnotations,\r\n  canModify,\r\n  isStylePopupOpen,\r\n  setIsStylePopupOpen,\r\n  isDatePickerOpen,\r\n  setDatePickerOpen,\r\n  isDatePickerMount,\r\n  setDatePickerMount,\r\n  hasAssociatedLink,\r\n  includesFormFieldAnnotation,\r\n  stylePopupRepositionFlag,\r\n  setStylePopupRepositionFlag,\r\n  closePopup,\r\n}) => {\r\n  const [\r\n    isDisabled,\r\n    isOpen,\r\n    isContextMenuPopupOpen,\r\n    isRightClickAnnotationPopupEnabled,\r\n    isNotesPanelDisabled,\r\n    isAnnotationStylePopupDisabled,\r\n    isInlineCommentingDisabled,\r\n    isNotesPanelOpen,\r\n    isLinkModalOpen,\r\n    isRichTextPopupOpen,\r\n    isMultiTab,\r\n    tabManager,\r\n    tabs,\r\n    notesInLeftPanel,\r\n    leftPanelOpen,\r\n    activeLeftPanel,\r\n    activeDocumentViewerKey,\r\n  ] = useSelector(\r\n    (state) => [\r\n      selectors.isElementDisabled(state, DataElements.ANNOTATION_POPUP),\r\n      selectors.isElementOpen(state, DataElements.ANNOTATION_POPUP),\r\n      selectors.isElementOpen(state, DataElements.CONTEXT_MENU_POPUP),\r\n      selectors.isRightClickAnnotationPopupEnabled(state),\r\n      selectors.isElementDisabled(state, DataElements.NOTES_PANEL),\r\n      selectors.isElementDisabled(state, DataElements.ANNOTATION_STYLE_POPUP),\r\n      selectors.isElementDisabled(state, DataElements.INLINE_COMMENT_POPUP),\r\n      selectors.isElementOpen(state, DataElements.NOTES_PANEL),\r\n      selectors.isElementOpen(state, DataElements.LINK_MODAL),\r\n      selectors.isElementOpen(state, 'richTextPopup'),\r\n      selectors.getIsMultiTab(state),\r\n      selectors.getTabManager(state),\r\n      selectors.getTabs(state),\r\n      selectors.getNotesInLeftPanel(state),\r\n      selectors.isElementOpen(state, DataElements.LEFT_PANEL),\r\n      selectors.getActiveLeftPanel(state),\r\n      selectors.getActiveDocumentViewerKey(state),\r\n    ],\r\n    shallowEqual,\r\n  );\r\n  const [t] = useTranslation();\r\n  const dispatch = useDispatch();\r\n  const [position, setPosition] = useState({ left: 0, top: 0 });\r\n  const [isCalibrationPopupOpen, setCalibrationPopupOpen] = useState(false);\r\n  const popupRef = useRef();\r\n\r\n  const isFocusedAnnotationSelected = isRightClickAnnotationPopupEnabled ? core.isAnnotationSelected(focusedAnnotation) : true;\r\n  const annotManager = core.getAnnotationManager();\r\n  const isNotesPanelOpenOrActive = isNotesPanelOpen || (notesInLeftPanel && leftPanelOpen && activeLeftPanel === 'notesPanel');\r\n  // on tablet, the behaviour will be like on desktop, including being draggable\r\n\r\n  useOnClickOutside(\r\n    popupRef,\r\n    useCallback((e) => {\r\n      const notesPanel = getRootNode().querySelector(`[data-element=\"${DataElements.NOTES_PANEL}\"]`);\r\n      const clickedInNotesPanel = notesPanel?.contains(e.target);\r\n      const clickedInLinkModal = getRootNode().querySelector('.LinkModal.open')?.contains(e.target);\r\n      const datePicker = getDatePicker();\r\n      const warningModal = getOpenedWarningModal();\r\n      const colorPicker = getOpenedColorPicker();\r\n\r\n      // the notes panel has mousedown handlers to handle the opening/closing states of this component\r\n      // we don't want this handler to run when clicked in the notes panel otherwise the opening/closing states may mess up\r\n      // for example: click on a note will call core.selectAnnotation which triggers the annotationSelected event\r\n      // and opens this component. If we don't exclude the notes panel this handler will run and close it after\r\n      if (!clickedInNotesPanel && !clickedInLinkModal && !warningModal && !colorPicker && !datePicker) {\r\n        if (isRightClickAnnotationPopupEnabled) {\r\n          closePopup();\r\n        } else {\r\n          dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n        }\r\n      }\r\n    }, [isRightClickAnnotationPopupEnabled])\r\n  );\r\n\r\n  const setPopupPosition = () => {\r\n    if (popupRef.current) {\r\n      setPosition(getAnnotationPopupPositionBasedOn(focusedAnnotation, popupRef, activeDocumentViewerKey));\r\n    }\r\n  };\r\n\r\n  // useLayoutEffect here to avoid flashing issue when popup is close and open on scroll\r\n  useLayoutEffect(() => {\r\n    if (focusedAnnotation || isStylePopupOpen || isDatePickerMount) {\r\n      setPopupPosition();\r\n    }\r\n    // canModify is needed here because the effect from useOnAnnotationPopupOpen hook will run again and determine which button to show, which in turn change the popup size and will need to recalculate position\r\n  }, [focusedAnnotation, isStylePopupOpen, isDatePickerMount, canModify, activeDocumentViewerKey]);\r\n\r\n\r\n  useEffect(() => {\r\n    if (focusedAnnotation && focusedAnnotation.ToolName === ToolNames.CALIBRATION_MEASUREMENT) {\r\n      setCalibrationPopupOpen(true);\r\n    }\r\n  }, [focusedAnnotation]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen || isRichTextPopupOpen) {\r\n      dispatch(actions.closeElement(DataElements.INLINE_COMMENT_POPUP));\r\n    }\r\n  }, [isOpen, isRichTextPopupOpen]);\r\n\r\n  /* VIEW FILE */\r\n  const wvServer = !!getHashParameters('webviewerServerURL', null);\r\n  const acceptFormats = wvServer ? window.Core.SupportedFileFormats.SERVER : window.Core.SupportedFileFormats.CLIENT;\r\n  const showViewFileButton = focusedAnnotation instanceof Annotations.FileAttachmentAnnotation && isMultiTab\r\n    && acceptFormats.includes(window.Core.mimeTypeToExtension[focusedAnnotation.getFileMetadata().mimeType]);\r\n\r\n  const onViewFile = useCallback(async () => {\r\n    if (!tabManager || !isMultiTab) {\r\n      return console.warn('Can\\'t open file in non-multi-tab mode');\r\n    }\r\n    const metaData = focusedAnnotation.getFileMetadata();\r\n    const fileAttachmentTab = tabs.find((tab) => tab.options.filename === metaData.filename);\r\n    if (fileAttachmentTab) { // If already opened once\r\n      await tabManager.setActiveTab(fileAttachmentTab.id, true);\r\n      return;\r\n    }\r\n    await tabManager.addTab(await focusedAnnotation.getFileData(), {\r\n      extension: window.Core.mimeTypeToExtension[metaData.mimeType],\r\n      filename: metaData.filename,\r\n      saveCurrentActiveTabState: true,\r\n      setActive: true,\r\n    });\r\n  }, [tabManager, focusedAnnotation, tabs, isMultiTab]);\r\n\r\n  /* ALL REACT HOOKS NEED TO BE BEFORE RENDERING */\r\n  if (isDisabled || !focusedAnnotation) {\r\n    return null;\r\n  }\r\n\r\n  /* COMMENT / DATE */\r\n  const selectedAnnotations = core.getSelectedAnnotations(activeDocumentViewerKey);\r\n  const numberOfSelectedAnnotations = selectedAnnotations.length;\r\n  const multipleAnnotationsSelected = numberOfSelectedAnnotations > 1;\r\n  const isFreeTextAnnot = focusedAnnotation instanceof Annotations.FreeTextAnnotation;\r\n  const isDateFreeTextCanEdit = isFreeTextAnnot && !!focusedAnnotation.getDateFormat() && core.canModifyContents(focusedAnnotation);\r\n  const numberOfGroups = core.getNumberOfGroups(selectedAnnotations, activeDocumentViewerKey);\r\n  const canGroup = numberOfGroups > 1;\r\n  const canUngroup = numberOfGroups === 1 && numberOfSelectedAnnotations > 1 && isFocusedAnnotationSelected;\r\n  const isAppearanceSignature =\r\n    focusedAnnotation instanceof Annotations.SignatureWidgetAnnotation\r\n    && focusedAnnotation.isSignedByAppearance();\r\n\r\n  const showCommentButton = (\r\n    (!isNotesPanelDisabled || !isInlineCommentingDisabled)\r\n    && (!multipleAnnotationsSelected || (multipleAnnotationsSelected && !isFocusedAnnotationSelected))\r\n    && focusedAnnotation.ToolName !== ToolNames.CROP\r\n    && !includesFormFieldAnnotation\r\n    && !focusedAnnotation.isContentEditPlaceholder()\r\n    && !focusedAnnotation.isUncommittedContentEditPlaceholder()\r\n    && !isAppearanceSignature\r\n  );\r\n\r\n  const onCommentAnnotation = () => {\r\n    if (isDateFreeTextCanEdit) {\r\n      setDatePickerOpen(true);\r\n      return;\r\n    }\r\n\r\n    dispatch(actions.closeElement('searchPanel'));\r\n    dispatch(actions.closeElement('redactionPanel'));\r\n    const contentEditManager = core.getContentEditManager();\r\n    if (contentEditManager.isInContentEditMode()) {\r\n      dispatch(actions.closeElement('textEditingPanel'));\r\n      contentEditManager.endContentEditMode();\r\n    }\r\n\r\n    dispatch(actions.triggerNoteEditing());\r\n    if (isInlineCommentingDisabled) {\r\n      dispatch(actions.openElement(DataElements.NOTES_PANEL));\r\n      dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n    } else {\r\n      if (!isNotesPanelOpen) {\r\n        dispatch(actions.openElement(DataElements.INLINE_COMMENT_POPUP));\r\n      }\r\n      closePopup();\r\n    }\r\n  };\r\n\r\n  const handleDateChange = (text) => {\r\n    annotManager.setNoteContents(focusedAnnotation, text);\r\n    annotManager.updateAnnotation(focusedAnnotation);\r\n  };\r\n\r\n  const onDatePickerShow = (isDatePickerShowed) => {\r\n    setDatePickerMount(isDatePickerShowed);\r\n  };\r\n\r\n  /* EDIT STYLE */\r\n  const annotationStyle = getAnnotationStyles(focusedAnnotation);\r\n  const hasStyle = Object.keys(annotationStyle).length > 0;\r\n\r\n  const toolsWithNoStyling = [\r\n    ToolNames.CROP,\r\n    ToolNames.RADIO_FORM_FIELD,\r\n    ToolNames.CHECK_BOX_FIELD,\r\n    ToolNames.VIDEO_REDACTION,\r\n    ToolNames.VIDEO_AND_AUDIO_REDACTION,\r\n    ToolNames.AUDIO_REDACTION,\r\n  ];\r\n\r\n  const showEditStyleButton = (\r\n    canModify\r\n    && hasStyle\r\n    && !isAnnotationStylePopupDisabled\r\n    && (!multipleAnnotationsSelected || canUngroup || (multipleAnnotationsSelected && !isFocusedAnnotationSelected))\r\n    && !toolsWithNoStyling.includes(focusedAnnotation.ToolName)\r\n    && !(focusedAnnotation instanceof Annotations.Model3DAnnotation)\r\n    && !focusedAnnotation.isContentEditPlaceholder()\r\n    && !focusedAnnotation.isUncommittedContentEditPlaceholder()\r\n    && !isAppearanceSignature\r\n  );\r\n\r\n  const hideSnapModeCheckbox = focusedAnnotation instanceof Annotations.EllipseAnnotation || !core.isFullPDFEnabled();\r\n\r\n  const onResize = () => {\r\n    setStylePopupRepositionFlag(!stylePopupRepositionFlag);\r\n  };\r\n\r\n  /* EDIT CONTENT */\r\n  const showContentEditButton =\r\n    focusedAnnotation.isContentEditPlaceholder()\r\n    && focusedAnnotation.getContentEditType() === window.Core.ContentEdit.Types.TEXT;\r\n\r\n  const onEditContent = async () => {\r\n    annotManager.trigger('annotationDoubleClicked', focusedAnnotation);\r\n\r\n    dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n  };\r\n\r\n  /* CLEAR APPEARANCE SIGNATURE */\r\n  const onClearAppearanceSignature = () => {\r\n    focusedAnnotation.clearSignature(annotManager);\r\n    dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n  };\r\n\r\n  /* REDACTION */\r\n  const redactionEnabled = core.isAnnotationRedactable(focusedAnnotation);\r\n  const showRedactionButton = redactionEnabled && !multipleAnnotationsSelected && !includesFormFieldAnnotation;\r\n\r\n  const onApplyRedaction = () => {\r\n    dispatch(applyRedactions(focusedAnnotation));\r\n    dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n  };\r\n\r\n  /* GROUP / UNGROUP */\r\n  const primaryAnnotation = selectedAnnotations.find((selectedAnnotation) => !selectedAnnotation.InReplyTo);\r\n\r\n  const showGroupButton =\r\n    isFocusedAnnotationSelected\r\n    && canGroup\r\n    && !includesFormFieldAnnotation;\r\n\r\n  const onGroupAnnotations = () => {\r\n    core.groupAnnotations(primaryAnnotation, selectedAnnotations);\r\n  };\r\n\r\n  const showUngroupButton = canUngroup;\r\n\r\n  const onUngroupAnnotations = () => {\r\n    core.ungroupAnnotations(selectedAnnotations);\r\n  };\r\n\r\n  /* FORM FIELD */\r\n  const formFieldCreationManager = core.getFormFieldCreationManager();\r\n  const isInFormFieldCreationMode = formFieldCreationManager.isInFormFieldCreationMode();\r\n  const showFormFieldButton = includesFormFieldAnnotation && isInFormFieldCreationMode;\r\n\r\n  const onOpenFormField = () => {\r\n    closePopup();\r\n    // We disable it while the form field popup is open to prevent having both open\r\n    // at the same time. We re-enable it when the form field popup is closed.\r\n    dispatch(actions.disableElement(DataElements.ANNOTATION_POPUP, PRIORITY_THREE));\r\n    dispatch(actions.openElement(DataElements.FORM_FIELD_EDIT_POPUP));\r\n  };\r\n\r\n  /* DELETE ANNOTATION */\r\n  const showDeleteButton = canModify;\r\n\r\n  const openContentEditDeleteWarningModal = () => {\r\n    const message = t('option.contentEdit.deletionModal.message');\r\n    const title = t('option.contentEdit.deletionModal.title');\r\n    const confirmBtnText = t('action.ok');\r\n\r\n    const warning = {\r\n      message,\r\n      title,\r\n      confirmBtnText,\r\n      onConfirm: () => onDeleteAnnotation(),\r\n    };\r\n    dispatch(actions.showWarningMessage(warning));\r\n  };\r\n\r\n  const onDeleteAnnotation = () => {\r\n    if (isFocusedAnnotationSelected) {\r\n      core.deleteAnnotations(core.getSelectedAnnotations());\r\n    } else {\r\n      core.deleteAnnotations([focusedAnnotation]);\r\n    }\r\n    closePopup();\r\n  };\r\n\r\n  /* LINK ANNOTATION */\r\n  const toolsThatCantHaveLinks = [\r\n    ToolNames.CROP,\r\n    ToolNames.SIGNATURE,\r\n    ToolNames.REDACTION,\r\n    ToolNames.REDACTION2,\r\n    ToolNames.REDACTION3,\r\n    ToolNames.REDACTION4,\r\n    ToolNames.STICKY,\r\n    ToolNames.STICKY2,\r\n    ToolNames.STICKY3,\r\n    ToolNames.STICKY4,\r\n  ];\r\n\r\n  const showLinkButton = (\r\n    !toolsThatCantHaveLinks.includes(focusedAnnotation.ToolName)\r\n    && !includesFormFieldAnnotation\r\n    && !focusedAnnotation.isContentEditPlaceholder()\r\n    // TODO(Adam): Update this once SoundAnnotation tool is created.\r\n    && !(focusedAnnotation instanceof Annotations.SoundAnnotation)\r\n    && !focusedAnnotation.isUncommittedContentEditPlaceholder()\r\n    && !isAppearanceSignature\r\n  );\r\n\r\n  const showCalibrateButton =\r\n    canModify\r\n    && focusedAnnotation.Measure\r\n    && focusedAnnotation instanceof Annotations.LineAnnotation;\r\n\r\n  const onOpenCalibration = () => {\r\n    dispatch(actions.closeElement(DataElements.ANNOTATION_POPUP));\r\n    dispatch(actions.openElement(DataElements.CALIBRATION_MODAL));\r\n  };\r\n\r\n  const linkAnnotationToURL = () => {\r\n    if (hasAssociatedLink) {\r\n      const annotationsToUnlink = isFocusedAnnotationSelected ? selectedAnnotations : [focusedAnnotation];\r\n      annotationsToUnlink.forEach((annot) => {\r\n        const linkAnnotations = getGroupedLinkAnnotations(annot);\r\n        linkAnnotations.forEach((linkAnnot, index) => {\r\n          annotManager.ungroupAnnotations([linkAnnot]);\r\n          if (annot instanceof Annotations.TextHighlightAnnotation && annot.Opacity === 0 && index === 0) {\r\n            annotManager.deleteAnnotations([annot, linkAnnot], null, true);\r\n          } else {\r\n            annotManager.deleteAnnotation(linkAnnot, null, true);\r\n          }\r\n        });\r\n      });\r\n      closePopup();\r\n    } else {\r\n      dispatch(actions.openElement(DataElements.LINK_MODAL));\r\n    }\r\n  };\r\n\r\n  /* DOWNLOAD FILE ATTACHMENT */\r\n  const showFileDownloadButton = focusedAnnotation instanceof Annotations.FileAttachmentAnnotation;\r\n\r\n  const downloadFileAttachment = (annot) => {\r\n    // no need to check that annot is of type file annot as the check is done in the JSX\r\n    // trigger the annotationDoubleClicked event so that it will download the file\r\n    annotManager.trigger('annotationDoubleClicked', annot);\r\n  };\r\n\r\n  /* AUDIO ANNOTATION */\r\n  const showAudioPlayButton = (\r\n    !isIE &&\r\n    !selectedMultipleAnnotations &&\r\n    focusedAnnotation instanceof Annotations.SoundAnnotation &&\r\n    focusedAnnotation.hasAudioData()\r\n  );\r\n\r\n  const handlePlaySound = (annotation) => {\r\n    dispatch(actions.setActiveSoundAnnotation(annotation));\r\n    dispatch(actions.triggerResetAudioPlaybackPosition(true));\r\n    dispatch(actions.openElement('audioPlaybackPopup'));\r\n  };\r\n\r\n  return (\r\n    <AnnotationPopup\r\n      isMobile={isMobile()}\r\n      isIE={isIE}\r\n      isOpen={isOpen}\r\n      isRightClickMenu={isRightClickAnnotationPopupEnabled}\r\n      isNotesPanelOpenOrActive={isNotesPanelOpenOrActive}\r\n      isRichTextPopupOpen={isRichTextPopupOpen}\r\n      isLinkModalOpen={isLinkModalOpen}\r\n      isContextMenuPopupOpen={isContextMenuPopupOpen}\r\n\r\n      popupRef={popupRef}\r\n      position={position}\r\n      focusedAnnotation={focusedAnnotation}\r\n\r\n      showViewFileButton={showViewFileButton}\r\n      onViewFile={onViewFile}\r\n\r\n      showCommentButton={showCommentButton}\r\n      onCommentAnnotation={onCommentAnnotation}\r\n      isDateFreeTextCanEdit={isDateFreeTextCanEdit}\r\n      isDatePickerOpen={isDatePickerOpen}\r\n      handleDateChange={handleDateChange}\r\n      onDatePickerShow={onDatePickerShow}\r\n      isCalibrationPopupOpen={isCalibrationPopupOpen}\r\n\r\n      showEditStyleButton={showEditStyleButton}\r\n      isStylePopupOpen={isStylePopupOpen}\r\n      hideSnapModeCheckbox={hideSnapModeCheckbox}\r\n      openEditStylePopup={() => setIsStylePopupOpen(true)}\r\n      closeEditStylePopup={() => setIsStylePopupOpen(false)}\r\n      annotationStyle={annotationStyle}\r\n      onResize={onResize}\r\n\r\n      showContentEditButton={showContentEditButton}\r\n      onEditContent={onEditContent}\r\n      openContentEditDeleteWarningModal={openContentEditDeleteWarningModal}\r\n\r\n      isAppearanceSignature={isAppearanceSignature}\r\n      onClearAppearanceSignature={onClearAppearanceSignature}\r\n\r\n      showRedactionButton={showRedactionButton}\r\n      onApplyRedaction={onApplyRedaction}\r\n\r\n      showGroupButton={showGroupButton}\r\n      onGroupAnnotations={onGroupAnnotations}\r\n      showUngroupButton={showUngroupButton}\r\n      onUngroupAnnotations={onUngroupAnnotations}\r\n\r\n      showFormFieldButton={showFormFieldButton}\r\n      onOpenFormField={onOpenFormField}\r\n\r\n      showDeleteButton={showDeleteButton}\r\n      onDeleteAnnotation={onDeleteAnnotation}\r\n\r\n      showLinkButton={showLinkButton}\r\n      hasAssociatedLink={hasAssociatedLink}\r\n      linkAnnotationToURL={linkAnnotationToURL}\r\n\r\n      showFileDownloadButton={showFileDownloadButton}\r\n      downloadFileAttachment={downloadFileAttachment}\r\n\r\n      showAudioPlayButton={showAudioPlayButton}\r\n      handlePlaySound={handlePlaySound}\r\n\r\n      showCalibrateButton={showCalibrateButton}\r\n      onOpenCalibration={onOpenCalibration}\r\n    />\r\n  );\r\n};\r\n\r\nAnnotationPopupContainer.propTypes = propTypes;\r\n\r\nexport default AnnotationPopupContainer;\r\n","import AnnotationPopupContainer from './AnnotationPopupContainer';\r\n\r\nexport default AnnotationPopupContainer;"],"sourceRoot":""}